name: ğŸ—ï¸ UsQuest Build & Deploy

# Manual trigger only â€” nothing runs until you click "Run workflow"
on:
    workflow_dispatch:
        inputs:
            build_android:
                description: "ğŸ¤– Build Android APK?"
                type: boolean
                default: false
            build_ios:
                description: "ğŸ Build iOS (TestFlight)?"
                type: boolean
                default: false
            build_profile:
                description: "ğŸ“¦ Build Profile"
                type: choice
                options:
                    - preview
                    - production
                default: preview

jobs:
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Step 1: Lint & Type Check
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    lint:
        name: ğŸ” Lint & Type Check
        runs-on: ubuntu-latest
        steps:
            - name: ğŸ“¥ Checkout code
              uses: actions/checkout@v4

            - name: ğŸ“¦ Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: 20
                  cache: npm

            - name: ğŸ“¥ Install dependencies
              run: npm ci

            - name: ğŸ” Run linter
              run: npm run lint
              continue-on-error: true

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Step 2: Android Build (if selected)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    build-android:
        name: ğŸ¤– Android Build
        needs: lint
        if: ${{ inputs.build_android }}
        runs-on: ubuntu-latest
        steps:
            - name: ğŸ“¥ Checkout code
              uses: actions/checkout@v4

            - name: ğŸ“¦ Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: 20
                  cache: npm

            - name: ğŸ“¥ Install dependencies
              run: npm ci

            - name: ğŸ”§ Setup EAS CLI
              uses: expo/expo-github-action@v8
              with:
                  eas-version: latest
                  token: ${{ secrets.EXPO_TOKEN }}

            - name: âš ï¸ Build Quota Reminder
              run: |
                  echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                  echo "â•‘  âš ï¸  ANDROID BUILD STARTING                 â•‘"
                  echo "â•‘  You have LIMITED EAS builds remaining!      â•‘"
                  echo "â•‘  Free tier: 30 builds/month                 â•‘"
                  echo "â•‘                                              â•‘"
                  echo "â•‘  This was a manual trigger â€” you approved    â•‘"
                  echo "â•‘  this build via workflow_dispatch.            â•‘"
                  echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

            - name: ğŸ—ï¸ Build Android (${{ inputs.build_profile }})
              run: eas build --platform android --profile ${{ inputs.build_profile }} --non-interactive

            - name: âœ… Android Build Complete
              run: |
                  echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                  echo "â•‘  âœ… Android build submitted to EAS!          â•‘"
                  echo "â•‘  Check expo.dev for the build status.        â•‘"
                  echo "â•‘                                              â•‘"
                  echo "â•‘  ğŸ“¥ Download the APK/AAB from expo.dev       â•‘"
                  echo "â•‘  ğŸ“¤ Upload manually to Google Play Console   â•‘"
                  echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Step 3: iOS Build (if selected)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    build-ios:
        name: ğŸ iOS Build
        needs: lint
        if: ${{ inputs.build_ios }}
        runs-on: ubuntu-latest
        steps:
            - name: ğŸ“¥ Checkout code
              uses: actions/checkout@v4

            - name: ğŸ“¦ Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: 20
                  cache: npm

            - name: ğŸ“¥ Install dependencies
              run: npm ci

            - name: ğŸ”§ Setup EAS CLI
              uses: expo/expo-github-action@v8
              with:
                  eas-version: latest
                  token: ${{ secrets.EXPO_TOKEN }}

            - name: ğŸ—ï¸ Build iOS (${{ inputs.build_profile }})
              run: eas build --platform ios --profile ${{ inputs.build_profile }} --non-interactive

            - name: âœ… iOS Build Complete
              run: |
                  echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                  echo "â•‘  âœ… iOS build submitted to EAS!              â•‘"
                  echo "â•‘  Check expo.dev for the build status.        â•‘"
                  echo "â•‘                                              â•‘"
                  echo "â•‘  Once complete, it will auto-appear in       â•‘"
                  echo "â•‘  TestFlight (if App Store Connect is set up) â•‘"
                  echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
